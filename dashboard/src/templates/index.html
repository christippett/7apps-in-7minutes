<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>7Apps â€” Google Cloud</title>
    <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bulma@0.9.0/css/bulma.min.css"
    />
    <link
      rel="stylesheet"
      href="https://cdn.materialdesignicons.com/5.3.45/css/materialdesignicons.min.css"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.0.0/animate.min.css"
    />
    <link href="/static/index.css?ts={{ unix_timestamp }}" rel="stylesheet" />
  </head>

  <body>
    <section class="is-flex-desktop">
      <div class="container is-flex-desktop">
        <div class="preface has-text-grey is-relative mb-6">
          <div class="content py-4">
            <h3>7-Apps on Google Cloud</h3>
            <p>
              The purpose of this demo is to showcase the many ways you can deploy a web
              app on Google Cloud.
            </p>
            <strong>Objectives</strong>
            <ol class="is-upper-roman">
              <li>
                Deploy the same code across all services â€” nothing about the application
                should be particular to any service (or Google Cloud for that matter)
              </li>
              <li>Each application should have its own custom domain</li>
              <li>
                Requests should be served over HTTPS, with SSL/TLS certificates
                provisioned automatically
              </li>
              <li>Deployments should be 100% automated</li>
            </ol>
          </div>
          <nav class="mb-5">
            <div class="tabs is-centered is-boxed is-small has-text-grey">
              <ul>
                <li class="is-active">
                  <a>
                    <span>Logs</span>
                  </a>
                </li>
                <li>
                  <a>
                    <span>Leaderboard</span>
                  </a>
                </li>
                <li>
                  <a>
                    <span>Cost</span>
                  </a>
                </li>
              </ul>
            </div>
          </nav>
          <div class="content-container">
            <div class="content">
              <p>
                Logs from Cloud Build will appear below when a deployment is active.
              </p>
            </div>
            <div class="logs noselect" id="logs">
              {% for id, logs in log_collection.items() %} {% for log in logs %}
              <p data-id="{{ log.id }}" data-step="{{ log.step_name }}"
                 data-source="{{ log.source }}" data-state="{{ log.state }}"
              >
                <span class="lg-ts">{{ log.text }}</span>
                <span class="lg-step">
                  {% if log.step_id %}Step {{ log.step_id }}{% endif %}
                </span>
                <span class="lg-text">{{ log.text }}</span>
              </p>
              {% endfor %} {% endfor %}
            </div>
          </div>
        </div>
        <div class="content is-hidden-desktop">
          <h3>Application frames</h3>
        </div>
        <div class="frames columns is-multiline">
          {% for app in app_list %} <div id="{{ app.name }}"
          class="column is-half is-flex is-relative">
          <div class="frame box is-flex is-relative is-clipped px-0 py-0">
            <div class="frame-label">
              <a target="_blank" rel="noopener noreferrer" href="{{ app.url }}"
                >{{ app.url }}</a
              >
            </div>
            <div
              id="{{ app.name }}-overlay"
              class="is-unavailable is-overlay px-6 py-6 is-size-6 has-text-weight-medium has-text-centered is-hidden"
            >
              <p class="heading">ðŸ›‘ {{ app.title }}</p>
              <p class="title is-size-5 mt-4"></p>
            </div>
            <iframe
              name="{{ unix_timestamp }}-{{ loop.index }}"
              class="is-clipped"
              src="{{ app.url }}?ts={{ unix_timestamp }}"
              data-id="{{ loop.index }}"
              data-url="{{ app.url }}"
              data-name="{{ app.name }}"
              data-title="{{ app.title }}"
            >
            </iframe>
          </div>
        </div>
        {% endfor %}
      </div>
    </section>
    <footer>
      <div class="content has-text-centered has-text-grey">
        <p>
          Source on
          <a
            href="https://github.com/servian/7apps7minutes"
            target="_blank"
            rel="noopener noreferrer"
            >GitHub</a
          >. Licensed <a href="http://opensource.org/licenses/mit-license.php">MIT</a>.
        </p>
      </div>
    </footer>
    <script src="/static/utils.js?ts={{ unix_timestamp }}"></script>
  </body>

  <script>
    /* eslint-disable no-undef */

    // Poll each app endpoint for liveliness and version changes
    App.startMonitor({ interval: 4000 });

    // Setup Cloud Build log sink
    var logContainerElement = document.getElementById("logs");
    LogStreamClient.connect(logContainerElement);
  </script>
</html>
